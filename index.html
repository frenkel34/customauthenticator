<html>
	<head>
		<title>MFA app</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="functions.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
		<center>
			<div class="callus"><a href="tel:+27860606060"><img class="imgcallus" src="callus.png"/></a></div>
			<img style="max-width: 80vw; max-height: 150px;" src="homelogo.gif">
			<div class="container-fluid">
			<div id="pag_secret" class="page">
				<input type="text" size="30" name="secret" id="secret" class="xlarge newSecret" value="" /><br>
				<a class="storeSecret" href="#">save secret</a> or <a class="resetSecret" href="#">reset app</a>
			</div>
			<div id="pag_otp" class="page">
				<div class="clearfix" class="timer">
					<label></label>
					<div class="input"><span id='updatingIn' style="font-size: 150%">&nbsp;</span></div>
					</div>
				<div class="progress-bar">
					<span class="progress-bar-fill" style="width: 100%"></span>
				</div>
				<label>One-time Password</label>
				<div class="input otp"><span class="label label-primary" style="font-size: 300%" id='otp'></span></div>
				<p><a class="resetSecret" href="#">reset secret</a></p>
			</div>
			<div id="pag_scan" class="page">
				<label>Please click to scan the QR and connect the app to your account</label>
				<div class="scanSecret navButton" type="button">scan qr</div>
			</div>
			<div id="pag_config" class="page">
				<label>Secret (hex)</label>
				<div class="input"><span class="label label-default" id="secretHex"></span><span id='secretHexLength'></span></div>
				<label>QR Code</label>
				<div class="input"><img id="qrImg" src="" /></div>
				<label>Unix epoch div 30 (padded hex)</label>
				<div class="input"><span class="label label-default" id='epoch'></span></div>
				<label>HMAC(secret, time)</label>
				<div class="input" id='hmac'></div>
				<label>Unix epoch div 30 (padded hex)</label>
				<div class="input"><span class="label label-default" id='epoch'></span></div>
			</div>
            <p class="bottom">This app is created for OML (v 0.1) and not to be used in prodduction.</p>
		</center>
	</body>
	<script type="text/javascript">
		// Setup the app
		$( document ).ready(function() {
			$(".page").hide();
			var storedSecret = localStorage.getItem('secret')
			if (storedSecret) {
				console.log('a secret has been configured within the app');
				$(".newSecret").val(storedSecret);
				startAuthenticator();
				$("#pag_otp").show();
			} else {
				console.log('the secret needs to be configured in the app');
				$(".page").hide();
				$("#pag_scan").show();
			}
		$("#pag_otp").show()
		})
		
		$(".menuitem").click(function() {
			var page = $( this ).attr('page');
			$(".page").hide();
			$("."+page).show();
		})

		$(".storeSecret").click(function(){
			var newSecret = $(".newSecret").val();
			console.log('storing new secret in app');
			localStorage.setItem('secret', newSecret);
			if (newSecret != '') {
				startAuthenticator();
			}
		})

		$("#lbl_title").click(function() {
			$("#pag_secret").slideToggle();
		});

		$(".scanSecret").click(function() {
			alert('This app will open your camera, please center the QR in the screen');
			scan();
		})

		$(".resetSecret").click(function() {
			$(".newSecret").val('');
			$(".page").hide()
			$("#pag_scan").show();

		})
	</script>
</html>